<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title th:text="${pageTitle} + ' - LinkVault'">Map Discover - LinkVault</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body>
<div class="app-layout">
    <div th:replace="~{fragments/layout :: sidebar}"></div>

    <div class="main-content" style="padding: 0; position: relative;">
        <div class="header-bar" style="padding: 16px 24px; margin-bottom: 0;">
            <h2 th:text="${pageTitle}">Map Discover</h2>
            <button th:unless="${isGuest}" class="btn btn-primary" onclick="openAddModal()">+ Share a Story</button>
        </div>

        <!-- Search Wrapper -->
        <div id="search-wrapper" class="map-search-wrapper">
            <input type="text" id="mapSearchInput" class="map-search-input"
                   placeholder="Search posts or places..." autocomplete="off"/>
            <div id="mapSearchResults" class="map-search-results" style="display:none;"></div>
        </div>

        <!-- Mode Selector (Admin only) -->
        <div th:if="${isAdmin}" id="mode-selector" class="map-mode-selector">
            <div class="map-mode-glider" id="modeGlider"></div>
            <button class="map-mode-btn active" id="modeBtnUser" onclick="setMode('USER')">USER</button>
            <button class="map-mode-btn" id="modeBtnAdmin" onclick="setMode('ADMIN')">ADMIN</button>
        </div>

        <div id="discoveryMap" class="discovery-map"></div>
    </div>
</div>

<div th:replace="~{fragments/layout :: postComposeModal}"></div>
<div th:replace="~{fragments/layout :: folderModal}"></div>
<div th:replace="~{fragments/layout :: searchModal}"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script th:src="@{/js/map.js}"></script>
<script th:src="@{/js/app.js}"></script>
<script th:inline="javascript">
var IS_ADMIN = /*[[${isAdmin}]]*/ false;
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    initDiscoveryMap();
});
</script>
</body>
</html>
