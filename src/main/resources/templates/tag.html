<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title th:text="${pageTitle} + ' - LinkVault'">LinkVault</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body>
<div class="app-layout">
    <div th:replace="~{fragments/layout :: sidebar}"></div>

    <div class="main-content">
        <div class="header-bar">
            <div>
                <h2 th:text="${pageTitle}">Tag</h2>
                <span style="font-size:0.82rem; color: var(--text-muted);"
                      th:text="${bookmarkList.size()} + ' bookmarks'">0 bookmarks</span>
            </div>
            <button th:unless="${isGuest}" class="btn btn-primary" onclick="openAddModal()">+ Share a Story</button>
        </div>

        <div class="post-grid" th:if="${!bookmarkList.isEmpty()}">
            <th:block th:each="bookmark, iter : ${bookmarkList}">
                <th:block th:if="${adPositions != null and adPositions.contains(iter.index)}">
                    <div th:replace="~{fragments/ad-card :: adCard}"></div>
                </th:block>
                <div th:replace="~{fragments/layout :: postCard(${bookmark})}"></div>
            </th:block>
        </div>
        <div class="empty-state" th:if="${bookmarkList.isEmpty()}">
            <h3>No bookmarks with this tag</h3>
        </div>
    </div>
</div>

<div th:replace="~{fragments/layout :: postComposeModal}"></div>
<div th:replace="~{fragments/layout :: folderModal}"></div>
<div th:replace="~{fragments/layout :: searchModal}"></div>
<script th:if="${adsEnabled and adsenseClientId != null and !adsenseClientId.isEmpty()}"
        th:src="'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=' + ${adsenseClientId}"
        async="async" crossorigin="anonymous"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script th:src="@{/js/map.js}"></script>
<script th:src="@{/js/app.js}"></script>
<script th:if="${adsEnabled}" th:src="@{/js/ad-manager.js}"></script>
</body>
</html>
